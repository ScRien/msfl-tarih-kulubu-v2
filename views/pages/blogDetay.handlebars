<section class="blog-detail">
{{! =========================================
        DÃœZENLE / SÄ°L BUTONLARI (SADE - ÅžIK)
    ========================================== }}
  {{#if isAuth}}
    {{#if (eq currentUsername post.username)}}
      <div class="blog-detail-actions">

        <a href="/blog/duzenle/{{post._id}}" class="action-btn edit">
          <i class="fa-solid fa-pen"></i>
          DÃ¼zenle
        </a>

        <form
          action="/blog/{{post._id}}/sil"
          method="POST"
          onsubmit="return confirm('Silmek istediÄŸine emin misin?');"
        >
          <input type="hidden" name="_csrf" value="{{csrfToken}}" />
          <button type="submit" class="action-btn delete">
            <i class="fa-solid fa-trash"></i>
            Sil
          </button>
        </form>

      </div>
    {{/if}}
  {{/if}}

  {{! HERO }}
{{!-- HERO --}}
  <div class="blog-detail-hero">

    <div class="blog-carousel-wrapper">

      <!-- ðŸ”¥ OKLAR (EKLENEN) -->
      <button id="prevBtn" class="carousel-arrow left">
        <i class="fa-solid fa-chevron-left"></i>
      </button>

      <button id="nextBtn" class="carousel-arrow right">
        <i class="fa-solid fa-chevron-right"></i>
      </button>

      <div class="blog-carousel-container">
        <div class="blog-carousel" id="blogCarousel">
          {{#if post.images.length}}
            {{#each post.images}}
              <div class="blog-slide">
                <img
                  class="blog-cover-img"
                  src="{{this.url}}"
                  alt="Blog GÃ¶rseli"
                />
              </div>
            {{/each}}
          {{else}}
            <div class="blog-slide">
              <img
                class="blog-cover-img"
                src="/img/default-blog.jpg"
                alt="VarsayÄ±lan GÃ¶rsel"
              />
            </div>
          {{/if}}
      </div>
      </div>

      <!-- ðŸ”¥ DOTS (EKLENEN) -->
      <div class="carousel-dots" id="carouselDots">
        {{#each post.images}}
          <div class="carousel-dot"></div>
        {{/each}}
      </div>

    </div>

    <div class="blog-detail-overlay"></div>

    <div class="blog-detail-title-wrapper">
      <p class="blog-detail-badge">MSFL TARÄ°H KULÃœBÃœ</p>
      <h1 class="blog-detail-title">{{post.title}}</h1>
      <div class="blog-detail-meta">
        <a href="/u/@{{post.username}}" class="blog-detail-author">
          @{{post.username}}
        </a>
        <span class="blog-detail-dot">â€¢</span>
        <span class="blog-detail-date">
          {{generateDateTime post.date "DD MMMM YYYY"}}
        </span>
      </div>
    </div>

  </div>

  {{! BODY }}
  <div class="blog-detail-body">

    {{! CONTENT }}
    <article class="blog-detail-article">

      <div class="blog-detail-content">
        {{{post.content}}}
      </div>

    </article>

    {{! COMMENTS }}
    <aside class="blog-detail-comments">
      <h2 class="comments-title">Yorumlar</h2>

      {{#if isAuth}}
        <form
          method="POST"
          action="/blog/{{post._id}}/yorum"
          class="comment-form"
        >
          <input type="hidden" name="_csrf" value="{{csrfToken}}" />
          <textarea
            name="content"
            placeholder="DÃ¼ÅŸÃ¼ncelerini bizimle paylaÅŸ..."
            required
          ></textarea>
          <button type="submit" class="comment-btn">GÃ¶nder</button>
        </form>
      {{else}}
        <p class="comment-login-info">
          Yorum yapmak iÃ§in
          <a href="/kullanici/oturumAc">oturum aÃ§</a>
          veya
          <a href="/kullanici/kayitOl">kayÄ±t ol</a>.
        </p>
      {{/if}}

      {{#if comments.length}}
        <ul class="comment-list">
        {{#each comments}}
          <li class="comment-item">

            <div class="comment-header">
              <div class="comment-user">
                <a href="/u/@{{this.username}}" class="comment-author">
                  @{{this.username}}
                </a>
                <span class="comment-date">
                  {{generateDate this.date "DD.MM.YYYY"}}
                </span>
              </div>

              {{!-- KullanÄ±cÄ± kendi yorumunu gÃ¶rÃ¼yorsa dÃ¼zenle / sil butonlarÄ± --}}
              {{#if (eq ../currentUsername this.username)}}
                <div class="comment-actions">
                  <a href="/blog/{{../post._id}}/yorum/{{this._id}}/duzenle" class="comment-edit-btn">
                    DÃ¼zenle
                  </a>

                  <form
                    action="/blog/{{../post._id}}/yorum/{{this._id}}/sil"
                    method="POST"
                    onsubmit="return confirm('Yorumu silmek istediÄŸine emin misin?');"
                  >
                    <input type="hidden" name="_csrf" value="{{../csrfToken}}" />
                    <button class="comment-delete-btn">Sil</button>
                  </form>
                </div>
              {{/if}}
            </div>

            <p class="comment-content">{{this.content}}</p>

          </li>
        {{/each}}
      </ul>
      {{else}}
        <p class="no-comments">HenÃ¼z yorum yok.</p>
      {{/if}}
    </aside>

  </div>
</section>

<script src="/js/blogCarousel.js"></script>