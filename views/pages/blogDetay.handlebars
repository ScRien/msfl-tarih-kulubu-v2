<section class="blog-read-section">
  <div class="blog-read-container">

    <!-- Üst Bilgi -->
    <div class="blog-header">
      <div class="header-left">
        <h2 class="blog-title">{{post.title}}</h2>
      </div>

      {{!-- BLOG EYLEMLERİ --}}
      {{#if isAuth}}
        {{#if (eq post.user_id currentUserId)}}
          <div class="blog-actions">
            <a href="/blog/{{post._id}}/duzenle" class="action-btn edit-btn">Düzenle</a>
            <form action="/blog/{{post._id}}/sil" method="POST">
              <button type="submit" class="action-btn delete-btn">Sil</button>
            </form>
          </div>
        {{/if}}

        {{#if (eq currentRole "admin")}}
          <div class="blog-actions">
            <a href="/blog/{{post._id}}/duzenle" class="action-btn edit-btn">Düzenle</a>
            <form action="/blog/{{post._id}}/sil" method="POST">
              <button type="submit" class="action-btn delete-btn">Sil</button>
            </form>
          </div>
        {{/if}}
      {{/if}}

      <div class="header-right">
        <p>
          Oluşturan Kullanıcı:
          <a href="/@{{post.username}}" class="creator-link">
            @{{post.username}}
          </a>
        </p>
        <p>Oluşturma Tarihi:
          <span>{{generateDate post.date "DD/MM/YYYY"}}</span>
        </p>
      </div>
    </div>

    <!-- İçerik -->
    <div class="blog-content">
      {{{post.content}}}
    </div>

    {{!-- === GÖRSELLER === --}}
    {{#if post.images}}
      {{#if post.images.length}}
        <div class="carousel" id="blogCarousel">

          <div class="carousel-inner">
            {{#each post.images}}
              <div class="carousel-item {{#if @first}}active{{/if}}">
                <img src="{{this.url}}" alt="Blog Görseli" />
              </div>
            {{/each}}
          </div>

          <div class="carousel-control-prev" onclick="prevSlide()">❮</div>
          <div class="carousel-control-next" onclick="nextSlide()">❯</div>

          <div class="carousel-indicators">
            {{#each post.images}}
              <button
                onclick="goToSlide({{@index}})"
                class="indicator {{#if @first}}active{{/if}}">
              </button>
            {{/each}}
          </div>

        </div>
      {{else}}
        <p class="no-images"><em>Bu bloga görsel eklenmemiş.</em></p>
      {{/if}}
    {{else}}
      <p class="no-images"><em>Bu bloga görsel eklenmemiş.</em></p>
    {{/if}}

    <!-- Yorumlar -->
    <div class="blog-comments">
      <div class="comments-header">
        <h3 class="section-title">Yorumlar</h3>

        {{#if isAuth}}
          <button class="add-comment-btn">+ Yorum Ekle</button>
        {{/if}}
      </div>

      <div class="comment-list">
        {{#if comments.length}}
          {{#each comments}}
            <div class="comment-card">
              <div class="comment-top">
                <a href="/@{{username}}"><h4>{{username}}</h4></a>

                {{#if (eq user_id ../currentUserId)}}
                  <div class="comment-actions">

                    <button
                      type="button"
                      class="edit-comment-btn"
                      data-id="{{_id}}"
                      data-content="{{content}}"
                      data-post="{{../post._id}}"
                    >
                      Düzenle
                    </button>

                    <form
                      action="/blog/{{../post._id}}/yorum/{{_id}}/sil"
                      method="POST"
                      onsubmit="return confirm('Yorum silinsin mi?')"
                    >
                      <button class="delete-comment-btn">Sil</button>
                    </form>

                  </div>
                {{/if}}
              </div>

              <p class="comment-text" id="comment-text-{{_id}}">{{content}}</p>
              <span class="comment-date">
                {{generateDate date "DD/MM/YYYY HH:mm"}}
              </span>
            </div>
          {{/each}}
        {{else}}
          <p><em>Henüz yorum yok. İlk yorumu sen yaz!</em></p>
        {{/if}}
      </div>

      {{#unless isAuth}}
        <p class="comment-login-info">
          Yorum yapmak için
          <a href="/kullanici/oturumAc">giriş yapın</a>.
        </p>
      {{/unless}}
    </div>

  </div>

  <!-- Yorum Ekle Modal -->
  <div class="comment-modal" id="comment-modal">
    <div class="comment-modal-content">
      <span class="close-modal" id="close-modal">&times;</span>
      <h3>Yorum Ekle</h3>

      <form id="comment-form" method="POST" action="/blog/{{post._id}}/yorum">
        <textarea
          name="content"
          rows="4"
          placeholder="Yorumunuzu yazın..."
          required
        ></textarea>
        <button type="submit" class="submit-comment-btn">Gönder</button>
      </form>
    </div>
  </div>

  <!-- Yorum Düzenle Modal -->
  <div class="comment-edit-modal" id="comment-edit-modal">
    <div class="edit-modal-content">
      <span class="close-edit-modal" id="close-edit-modal">&times;</span>
      <h3>Yorumu Düzenle</h3>

      <form id="edit-comment-form" method="POST">
        <textarea
          name="content"
          id="edit-comment-textarea"
          rows="4"
          required
        ></textarea>
        <button type="submit" class="submit-comment-btn">Kaydet</button>
      </form>
    </div>
  </div>

</section>