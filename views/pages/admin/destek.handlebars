<div class="admin-search-bar">
  <h1>YardÄ±m & Destek MesajlarÄ±</h1>

  <form action="/admin/destek" method="GET" class="admin-filter-bar">

    <!-- ðŸ” Genel arama -->
    <input
      type="text"
      name="q"
      placeholder="Ä°sim, e-posta veya iÃ§erik ara..."
      class="search-input"
      value="{{query.q}}"
    />

    <!-- ðŸŽ¯ Konu filtresi -->
    <select name="topic">
      <option value="">TÃ¼m Konular</option>
      <option value="Teknik Hata" {{#if (eq query.topic "Teknik Hata")}}selected{{/if}}>
        Teknik Hata
      </option>
      <option value="Ä°Ã§erik Ã–nerisi" {{#if (eq query.topic "Ä°Ã§erik Ã–nerisi")}}selected{{/if}}>
        Ä°Ã§erik Ã–nerisi
      </option>
      <option value="Ä°ÅŸ BirliÄŸi" {{#if (eq query.topic "Ä°ÅŸ BirliÄŸi")}}selected{{/if}}>
        Ä°ÅŸ BirliÄŸi
      </option>
      <option value="DiÄŸer" {{#if (eq query.topic "DiÄŸer")}}selected{{/if}}>
        DiÄŸer
      </option>
    </select>

    <!-- ðŸ†• Durum filtresi -->
    <select name="status">
      <option value="">TÃ¼m Durumlar</option>
      <option value="new" {{#if (eq query.status "new")}}selected{{/if}}>
        Yeni
      </option>
      <option value="read" {{#if (eq query.status "read")}}selected{{/if}}>
        OkunmuÅŸ
      </option>
    </select>

    <button type="submit" class="admin-btn">
      Filtrele
    </button>

    {{!-- âœ… Temizle --}}
    {{#if query.q}}
        <a href="/admin/destek" class="admin-btn ghost">Temizle</a>
    {{else if query.topic}}
        <a href="/admin/destek" class="admin-btn ghost">Temizle</a>
    {{else if query.status}}
        <a href="/admin/destek" class="admin-btn ghost">Temizle</a>
    {{/if}}

  </form>
</div>

<div class="table-container">
  <p style="margin-top:10px; margin-bottom:20px; font-size:14px; color:#555;">
  {{messages.length}} kayÄ±t bulundu
</p>

  <table class="admin-table">
    <thead>
      <tr>
        <th width="60">Durum</th>
        <th>Ad Soyad</th>
        <th>E-posta</th>
        <th>Konu</th>
        <th>Tarih</th>
        <th>Ä°ÅŸlem</th>
      </tr>
    </thead>

    <tbody>
      {{#if messages.length}}
        {{#each messages}}
          <tr class="{{#if (eq status 'new')}}is-new{{/if}}">
            <td>
              {{#if (eq status "new")}}
                ðŸ†•
              {{else}}
                âœ…
              {{/if}}
            </td>
            <td>{{name}}</td>
            <td>{{email}}</td>
            <td>{{topic}}</td>
            <td>{{generateDateTime createdAt}}</td>
            <td>
              <a href="/admin/destek/{{_id}}" class="action-btn btn-view">
                GÃ¶rÃ¼ntÃ¼le â†’
              </a>
            </td>
          </tr>
        {{/each}}
      {{else}}
        <tr>
          <td colspan="6" style="text-align:center; opacity:.6;">
            KayÄ±tlÄ± destek mesajÄ± bulunamadÄ±.
          </td>
        </tr>
      {{/if}}
    </tbody>
  </table>
</div>
