<link rel="stylesheet" href="/css/hesap.css?v=4" />

<section class="account-wrapper">

  <!-- ========== SOL SIDEBAR ========== -->
  <aside class="account-sidebar">

    <a href="/u/@{{username}}" class="public-profile-btn">
      Profilimi Görüntüle →
    </a>

    <div class="sidebar-category">Hesap</div>
    <button type="button" class="sidebar-item active" data-target="profile">
      Profil Bilgileri
    </button>

    <div class="sidebar-category">Profil Medyası</div>
    <button type="button" class="sidebar-item" data-target="media">
      Profil Fotoğrafları
    </button>

    <div class="sidebar-category">Sosyal</div>
    <button type="button" class="sidebar-item" data-target="social">
      Sosyal Medya
    </button>

    <div class="sidebar-category">Gizlilik & Güvenlik</div>
    <button type="button" class="sidebar-item" data-target="password">
      Şifre Değiştir
    </button>

    <div class="sidebar-category">Diğer</div>
    <button type="button" class="sidebar-item danger" data-target="delete">
      Hesabı Sil
    </button>

  </aside>

  <!-- ========== SAĞ PANEL ========== -->
  <main class="account-content">

    <!-- LOADER -->
    <div id="accountLoading" class="account-loading">
      <div class="spinner"></div>
      <p>Hesap bilgileri yükleniyor...</p>
    </div>

    <!-- ========== PROFİL ========== -->
    <div class="content-box" id="profile" style="display:block;">
      <h2 class="title">Profil Bilgileri</h2>
      <p class="desc">Bilgilerinizi buradan güncelleyebilirsiniz.</p>

      <form id="profileForm" action="/hesap/profil" method="POST">
        <input type="hidden" name="_csrf" value="{{csrfToken}}" />

        <div class="form-group">
          <label>Kullanıcı Adı</label>
          <input value="{{user.username}}" disabled />
        </div>

        <div class="form-group">
          <label>Ad</label>
          <input name="name" value="{{user.name}}" disabled />
          <span class="info">Bu alan değiştirilemez.</span>
        </div>

        <div class="form-group">
          <label>Soyad</label>
          <input name="surname" value="{{user.surname}}" disabled />
          <span class="info">Bu alan değiştirilemez.</span>
        </div>

        <div class="form-group">
          <label>E-posta</label>
          <input type="email" name="email" value="{{user.email}}" />
        </div>

        <div class="form-group">
          <label>Biyografi</label>
          <textarea name="bio" maxlength="200">{{user.bio}}</textarea>
          <span class="info">200 karakter sınırı</span>
        </div>

        <div class="btn-group">
          <button class="btn save">Kaydet</button>
          <button class="btn cancel" type="reset">İptal</button>
        </div>
      </form>
    </div>

    <!-- ========== SOSYAL ========== -->
    <div class="content-box" id="social">
      <h2 class="title">Sosyal Medya</h2>

      <form action="/hesap/social" method="POST">
        <input type="hidden" name="_csrf" value="{{csrfToken}}" />

        <div class="form-group">
          <label>Instagram</label>
          <input name="instagram" value="{{user.social.instagram}}" placeholder="@kullaniciadi" />
        </div>

        <div class="form-group">
          <label>X (Twitter)</label>
          <input name="x" value="{{user.social.x}}" placeholder="@kullaniciadi" />
        </div>

        <div class="form-group">
          <label>GitHub</label>
          <input name="github" value="{{user.social.github}}" placeholder="kullaniciadi" />
        </div>

        <div class="btn-group">
          <button class="btn save">Kaydet</button>
          <button class="btn cancel" type="reset">İptal</button>
        </div>
      </form>
    </div>

    <!-- ========== MEDYA ========== -->
    <div class="content-box" id="media">
      <h2 class="title">Profil Medyası</h2>
      <span class="img-hint">
        Maks. 5MB (JPEG/PNG) • Önerilen: Avatar 400x400, Kapak 800x400
      </span>

      <div class="profile-section">
        <h3>Profil Fotoğrafı</h3>

        <div class="avatar-box">
          <img
            id="avatarPreview"
            src="{{#if user.avatar.url}}{{user.avatar.url}}{{else}}/img/default-avatar.png{{/if}}"
            class="avatar-img"
            onerror="this.src='/img/default-avatar.png'"
          />
        </div>

        <label class="upload-btn" for="avatarUpload">Yeni Avatar Yükle</label>
        <input
          type="file"
          id="avatarUpload"
          class="hidden-input"
          accept="image/*"
        />
      </div>

      <div class="cover-section">
        <h3>Kapak Fotoğrafı</h3>

        <div class="cover-box">
          <img
            id="coverPreview"
            src="{{#if user.coverImage.url}}{{user.coverImage.url}}{{else}}/img/default-cover.png{{/if}}"
            class="cover-img"
            onerror="this.src='/img/default-cover.png'"
          />
        </div>

        <label class="upload-btn" for="coverUpload">Yeni Kapak Yükle</label>
        <input
          type="file"
          id="coverUpload"
          class="hidden-input"
          accept="image/*"
        />
      </div>
    </div>

    <!-- ========== ŞİFRE ========== -->
    <div class="content-box" id="password">
      <h2 class="title">Şifre Değiştir</h2>
      <p class="desc">Mail adresinize doğrulama kodu gönderilecektir.</p>

      <form action="/hesap/sifre-kod" method="POST">
        <input type="hidden" name="_csrf" value="{{csrfToken}}" />
        <button class="btn save">Mailime Kod Gönder</button>
      </form>

      <div id="verifyBox" style="display:none;" data-show="{{showVerify}}">
        <br>
        <hr>
        <br>
        <form action="/hesap/sifre-dogrula" method="POST">
          <input type="hidden" name="_csrf" value="{{csrfToken}}" />

          <div class="form-group">
            <label>Mail ile gelen kod</label>
            <input name="code" maxlength="6" required placeholder="123456" />
          </div>

          <button class="btn save">Kodu Doğrula</button>
        </form>
      </div>
    </div>

    <!-- ========== HESAP SİL ========== -->
    <div class="content-box" id="delete">
      <h2 class="title danger">Hesabı Sil</h2>
      <p class="desc">Bu işlem geri alınamaz. Tüm verileriniz silinecektir.</p>

      <button type="button" class="danger-btn">
        Hesabımı Kalıcı Olarak Sil
      </button>
    </div>

  </main>
</section>

<!-- ========== DELETE MODAL ========== -->
<div id="deleteModal" class="delete-modal">
  <div class="delete-modal-content">
    <h2>Hesabı Sil</h2>

    <form id="deleteForm" action="/hesap/sil" method="POST">
      <input type="hidden" name="_csrf" value="{{csrfToken}}" />

      <label class="modal-label">Onay için "sil" yazınız.</label>
      <input id="confirmC" class="modal-input" maxlength="3" autocomplete="off" />

      <label class="modal-label">Şifre</label>
      <input
        type="password"
        id="deletePassword"
        name="password"
        class="modal-input"
        required
      />

      <p id="modalError" style="color: red; margin-top: 10px; font-size: 0.9rem;"></p>

      <div class="modal-buttons">
        <button
          type="button"
          class="cancel-btn"
        >Vazgeç</button>
        <button
          type="button"
          class="delete-btn"
        >Hesabı Sil</button>
      </div>
    </form>
  </div>
</div>

<script type="module" src="/js/hesap.js"></script>