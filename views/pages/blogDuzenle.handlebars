<section class="blog-edit-section">
  <div class="blog-edit-container">

    <h1 class="edit-title">Blogu DÃ¼zenle</h1>

    <form
      action="/blog/{{post._id}}/duzenle"
      method="POST"
      enctype="multipart/form-data"
      class="edit-form"
    >

      <!-- BAÅLIK -->
      <label>BaÅŸlÄ±k</label>
      <input
        type="text"
        name="title"
        class="edit-input"
        value="{{post.title}}"
        required
      />

      <!-- Ä°Ã‡ERÄ°K -->
      <label>Ä°Ã§erik</label>
      <textarea
        name="content"
        class="edit-textarea"
        rows="10"
        required
      >{{post.content}}</textarea>

      <!-- MEVCUT GÃ–RSELLER -->
      <label>Mevcut GÃ¶rseller</label>
      <div class="edit-existing-images">

        {{#if post.images.length}}
          {{#each post.images}}
            <div class="existing-img-wrapper">
              
              <!-- GÃ–RSEL -->
              <img src="{{this.url}}" class="existing-img" alt="Blog GÃ¶rseli" />

              <!-- SÄ°LME CHECKBOX -->
              <label class="delete-badge">
                <input type="checkbox" name="deleteImages" value="{{this.public_id}}" />
                Sil
              </label>

            </div>
          {{/each}}
        {{else}}
          <p><em>GÃ¶rsel eklenmemiÅŸ.</em></p>
        {{/if}}

      </div>

      <!-- YENÄ° GÃ–RSEL EKLE -->
      <label>Yeni GÃ¶rsel Ekle</label>

      <div class="edit-upload-wrapper">
        <label for="newImages" class="edit-upload-label">
          ğŸ“ Yeni GÃ¶rsel SeÃ§
        </label>

        <input
          type="file"
          id="newImages"
          name="newImages"
          accept="image/*"
          multiple
          class="edit-file-input"
        />

        <span id="new-file-count" class="new-file-count">
          HenÃ¼z yeni gÃ¶rsel seÃ§ilmedi
        </span>
      </div>

      <!-- YENÄ° GÃ–RSELLER Ã–NÄ°ZLEME -->
      <div id="preview-container" class="preview-container"></div>

      <!-- BUTONLAR -->
      <div class="edit-buttons">
        <button type="submit" class="save-btn">Kaydet</button>
        <a href="/blog/{{post._id}}" class="cancel-btn">Ä°ptal</a>
      </div>

    </form>

  </div>
</section>

<script>
  const input = document.getElementById("newImages");
  const preview = document.getElementById("preview-container");
  const fileCount = document.getElementById("new-file-count");

  let selectedNewFiles = [];

  if (input) {
    input.addEventListener("change", () => {
      selectedNewFiles = [...input.files];
      updatePreview();
    });
  }

  function updatePreview() {
    preview.innerHTML = "";

    if (!selectedNewFiles.length) {
      fileCount.textContent = "HenÃ¼z yeni gÃ¶rsel seÃ§ilmedi";
      return;
    }

    fileCount.textContent = selectedNewFiles.length + " yeni gÃ¶rsel seÃ§ildi";

    selectedNewFiles.forEach((file, index) => {
      const reader = new FileReader();

      reader.onload = (e) => {
        const box = document.createElement("div");
        box.className = "preview-item";

        const img = document.createElement("img");
        img.src = e.target.result;
        img.className = "preview-img";

        const removeBtn = document.createElement("button");
        removeBtn.className = "remove-btn";
        removeBtn.innerHTML = "Ã—";
        removeBtn.onclick = () => removeNewImage(index);

        box.appendChild(img);
        box.appendChild(removeBtn);
        preview.appendChild(box);
      };

      reader.readAsDataURL(file);
    });
  }

  function removeNewImage(index) {
    selectedNewFiles.splice(index, 1);

    const dataTransfer = new DataTransfer();
    selectedNewFiles.forEach((f) => dataTransfer.items.add(f));
    input.files = dataTransfer.files;

    updatePreview();
  }
</script>
